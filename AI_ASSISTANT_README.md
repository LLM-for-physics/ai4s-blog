# AI 助手功能使用说明

## 功能概述

已为网站添加了一个 AI 聊天助手功能，用户可以在每个页面的右下角看到一个悬浮按钮 💬，点击即可展开聊天窗口与 AI 进行对话。

## 核心特性

✅ 右下角悬浮按钮
✅ 可展开/收起的聊天窗口
✅ 自动获取当前页面 markdown 内容作为上下文
✅ 多轮对话支持
✅ 本地存储对话历史（刷新页面不丢失）
✅ 清空对话历史功能
✅ 响应式设计（支持移动端）
✅ 深色/浅色模式自适应

## 配置说明

### 环境变量

已配置在 `.env` 文件中：

```env
VITE_OPENAI_API_KEY=sk-Y0eGRTVWfwVeZx2jwhxd6xfvYjlwoTVtiFffbsqRVkuFbArZ
VITE_OPENAI_BASE_URL=http://162.105.151.181/v1
VITE_MODEL=qwen3-max
```

### 重要提示

⚠️ **首次运行或修改 `.env` 后，必须重启 Vite 开发服务器**

1. 停止当前运行的开发服务器（Ctrl+C）
2. 重新运行：`yarn docs:dev`

这样环境变量才能被正确加载。

## 使用方法

### 启动开发服务器

```bash
yarn docs:dev
```

### 在浏览器中测试

1. 打开任意页面（如：http://localhost:5173/）
2. 查看右下角是否有 💬 悬浮按钮
3. 点击按钮打开聊天窗口
4. 输入问题并发送
5. AI 会基于当前页面内容回答问题

### 功能说明

- **Enter 键**：发送消息
- **Shift + Enter**：换行
- **🗑️ 按钮**：清空对话历史
- **✕ 按钮**：关闭聊天窗口

## 实现细节

### 文件结构

```
.env                                      # 环境变量配置
docs/.vitepress/
  ├── components/
  │   └── AIAssistant.vue                # AI 助手组件
  └── theme/
      └── index.ts                       # 主题配置（已集成组件）
```

### 技术栈

- Vue 3 Composition API
- TypeScript
- VitePress 主题系统
- Fetch API（调用 LLM API）

### 上下文提取

组件会自动提取当前页面的：
- 页面标题
- 页面路径
- 完整 markdown 内容

这些信息会作为系统提示词（system prompt）发送给 LLM，使 AI 能够基于当前页面内容回答问题。

## 调试

如果 AI 助手无法正常工作，请检查浏览器控制台：

1. 打开浏览器开发者工具（F12）
2. 查看控制台是否有警告或错误信息
3. 应该能看到类似以下调试信息：

```
AI Assistant: 环境变量未正确配置
API_KEY: 已设置
BASE_URL: http://162.105.151.181/v1
MODEL: qwen3-max
```

如果 `BASE_URL` 显示 "未设置"，说明环境变量未加载，需要重启开发服务器。

## 生产部署

构建生产版本：

```bash
yarn docs:build
```

部署时确保 `.env` 文件在构建环境中可用，或者在部署平台上设置相应的环境变量。

**注意**：`.env` 文件已被添加到 `.gitignore`，不会被提交到 Git 仓库。在部署时需要单独配置环境变量。

## 后续改进方向

可以考虑的功能扩展：

- [ ] 添加打字机效果显示 AI 回复
- [ ] 支持 Markdown 渲染（代码高亮、表格等）
- [ ] 添加导出对话历史功能
- [ ] 支持多个模型切换
- [ ] 添加流式响应（SSE）
- [ ] 添加对话历史搜索功能
- [ ] 支持图片上传和分析

## 常见问题

### Q: 为什么点击发送后没有反应？

A: 请检查：
1. 环境变量是否正确配置
2. 开发服务器是否重启
3. 浏览器控制台是否有错误信息
4. 网络连接是否正常

### Q: 如何修改 API 配置？

A: 编辑 `.env` 文件，然后重启开发服务器。

### Q: 对话历史保存在哪里？

A: 保存在浏览器的 localStorage 中，刷新页面不会丢失，但清除浏览器数据会删除历史记录。
