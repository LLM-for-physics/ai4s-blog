# åŒ—å¤§ç‰©ç†å­¦é™¢ LLM ç½‘å…³

æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²äº† LLM ç½‘å…³æœåŠ¡ï¼šhttp://162.105.151.181/ ã€‚è¯¥å¹³å°åŸºäº New API è®¾è®¡å’Œå¼€å‘ã€‚è‹¥æ‚¨åœ¨ä½¿ç”¨ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æ‰«æé¡µé¢ä¸‹æ–¹å†…æµ‹ç¾¤äºŒç»´ç åŠ å…¥å†…æµ‹ç¾¤ï¼Œæˆ–è”ç³»åŠ©æ•™ã€‚

å†…æµ‹æ—¶é—´ï¼š å¹³å°å·²äº 2025å¹´9æœˆ17æ—¥ å¼€å¯å†…æµ‹ï¼Œåå‡ ä½å¿—æ„¿è€…åŒå­¦æµ‹è¯•åŠŸèƒ½å¹¶è¿›è¡Œé—®é¢˜åé¦ˆï¼Œäº 20 æ—¥å¼€æ”¾æ³¨å†Œä½¿ç”¨ã€‚  
ä½¿ç”¨ç›®çš„ï¼š æœ¬å¹³å°**ä»…ç”¨äºå­¦æœ¯ç ”ç©¶å’Œç‰©ç†ä¸äººå·¥æ™ºèƒ½è¯¾ç¨‹å®è·µï¼Œä¸æ¶‰åŠä»»ä½•å•†ä¸šç”¨é€”**ã€‚  

## åŠŸèƒ½è¯´æ˜

ç›®å‰å…¬å¼€æ”¯æŒçš„æ¨¡å‹ï¼ˆæˆªè‡³ 2025.10.01ï¼‰ï¼š
- é€šä¹‰åƒé—®ç³»åˆ—
- DeepSeek ç³»åˆ—

**æ³¨æ„**ï¼šqwen "vl" ç³»åˆ—å¤§æ¨¡å‹æ”¯æŒå¤šæ¨¡æ€åŠŸèƒ½ã€‚æœªæ¥è®¡åˆ’å¼€æ”¾ OpenAI GPTã€Claudeã€Gemini ç­‰å›½å¤–å•†ç”¨å¤§æ¨¡å‹çš„ä½¿ç”¨ã€‚

## ä½¿ç”¨æ–¹æ³•

### 1. è´¦å·æ³¨å†Œ
è¯·é€‰ä¿®"ç‰©ç†ä¸äººå·¥æ™ºèƒ½"è¯¾ç¨‹çš„åŒå­¦åœ¨ç½‘å…³ä¸Šæ³¨å†Œè´¦å·ï¼Œ**ç”¨æˆ·åè¯·è®¾ç½®ä¸ºæ‚¨çš„å­¦å·**ã€‚æ³¨å†Œå®Œæˆåï¼Œç®¡ç†å‘˜ä¼šä¸ºæ¯ä½åŒå­¦çš„è´¦å·è®¾ç½®ä¸€å®šçš„ä½™é¢ã€‚
<!-- ç„¶åè¯·æ ¹æ®ä¸‹å›¾åšè´¦å·è®¾ç½®ï¼Œå°†â€œæ¥å—æœªè®¾ç½®ä»·æ ¼æ¨¡å‹â€é€‰é¡¹ä»â€œå…³â€åˆ‡æ¢åˆ°â€œå¼€ï¼š
![è´¦å·è®¾ç½®](./llm-gateway/1.png) -->

### 2. æ¨¡å‹æµ‹è¯•
æ‚¨å¯ä»¥åœ¨å·¦ä¾§èœå•æ çš„"æ“ç»ƒåœº"ä¸­è¿›è¡Œä¸åŒ LLM çš„å¯¹è¯å’Œè°ƒè¯•ã€‚
æ¨¡å‹æ“ç»ƒåœºå¯ä»¥åˆ‡æ¢ä¸åŒçš„å¤§æ¨¡å‹è¿›è¡Œå¯¹è¯ï¼Œåˆ‡æ¢çš„æ—¶å€™å¯¹è¯å†å²ä»ç„¶ä¼šä¿ç•™ï¼Œä½ å¯ä»¥ç‚¹å‡»ğŸ—‘ï¸å›¾æ ‡æ¥æ¸…ç©ºæˆ–åˆ é™¤å¯¹è¯å†å²ï¼Œä»¥é˜²æ­¢å¯¹è¯å†å²å¤æ‚é”™ä¹±å¯¼è‡´çš„å¤§æ¨¡å‹å¹»è§‰ã€‚
![å¯¹è¯å†å²ç®¡ç†](./llm-gateway/2.png)
æ™®é€šç”¨æˆ·å¯ä»¥è°ƒç”¨ default åˆ†ç»„ä¸‹çš„å¤§æ¨¡å‹ï¼Œå¯ä»¥åœ¨æ¨¡å‹å¹¿åœºç•Œé¢æŸ¥çœ‹ï¼š
![å¯ä»¥è®¿é—®çš„å¤§æ¨¡å‹](./llm-gateway/5.png)
éƒ¨åˆ†å¤§æ¨¡å‹æ”¯æŒå¤šæ¨¡æ€åŠŸèƒ½ï¼ˆæ¯”å¦‚å›¾ç‰‡ç†è§£ï¼‰ï¼š
![å›¾ç‰‡ç†è§£](./llm-gateway/6.png)

### 3. API è°ƒç”¨ ï¼ˆOpenAI æ ¼å¼ï¼‰
å¦‚éœ€é€šè¿‡ç¨‹åºè°ƒç”¨ LLM APIï¼š

1. åœ¨å·¦ä¾§"ä»¤ç‰Œç®¡ç†"å¤„ç‚¹å‡»"æ·»åŠ ä»¤ç‰Œ"è·å– API Key
   ![è·å– API Key](./llm-gateway/4.png)
2. åœ¨ç¨‹åºä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```bash
   OPENAI_BASE_URL=http://162.105.151.181/v1
   OPENAI_API_KEY=sk-{YOUR_API_KEY}
   ```
3. ä½¿ç”¨ Python çš„ openai åº“è°ƒç”¨å¤§æ¨¡å‹ï¼š
   ```python
   import openai
   
   client = openai.OpenAI(
       base_url="http://162.105.151.181/v1",
       api_key="sk-{YOUR_API_KEY}"
   )
   ```
4. æˆ–è€…ç”¨ curl å‘èµ·è¯·æ±‚ï¼ˆ`"stream": true` è¡¨ç¤ºæµå¼è¾“å‡ºï¼‰ï¼š
   ```bash
   curl -X POST http://162.105.151.181/v1/chat/completions \
   -H "Content-Type: application/json" \
   -H "Authorization: Bearer sk-{YOUR_API_KEY}" \
   -d '{
      "model": "deepseek-v3-250324",
      "messages": [{"role": "user", "content": "hello"}],
      "stream": true
   }'
   ```

### 4. API è°ƒç”¨ ï¼ˆAnthropic æ ¼å¼ï¼‰
å¦‚éœ€é€šè¿‡ç¨‹åºè°ƒç”¨ LLM APIï¼š

1. åœ¨å·¦ä¾§"ä»¤ç‰Œç®¡ç†"å¤„ç‚¹å‡»"æ·»åŠ ä»¤ç‰Œ"è·å– API Keyï¼Œå¹¶è®¾ç½® `VIP åˆ†ç»„`
2. åœ¨ç¨‹åºä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```bash
   ANTHROPIC_BASE_URL=http://162.105.151.181
   ANTHROPIC_API_KEY=sk-{YOUR_API_KEY}
   ```
3. ä½¿ç”¨ Python çš„ anthropic åº“è°ƒç”¨å¤§æ¨¡å‹ï¼š
   ```python
   import anthropic

   client = anthropic.Anthropic(
       base_url="http://162.105.151.181",
       api_key="sk-{YOUR_API_KEY}"
   )

   response = client.messages.create(
       model="claude-sonnet-4-5-20250929",
       max_tokens=1024,
       messages=[
           {"role": "user", "content": "Hello, Claude!"}
       ]
   )
   print(response.content[0].text)
   ```
4. æˆ–è€…ç”¨ curl å‘èµ·è¯·æ±‚ï¼ˆ`"stream": true` è¡¨ç¤ºæµå¼è¾“å‡ºï¼‰ï¼š
   ```bash
   curl -X POST http://162.105.151.181/v1/messages \
   -H "Content-Type: application/json" \
   -H "anthropic-version: 2023-06-01" \
   -H "x-api-key: sk-{YOUR_API_KEY}" \
   -d '{
      "model": "claude-sonnet-4-5-20250929",
      "stream": true,
      "messages": [{"role": "user", "content": "Hello"}]
   }'
   ```

### 5. API è°ƒç”¨ ï¼ˆGoogle Gemini æ ¼å¼ï¼‰
1. åœ¨å·¦ä¾§"ä»¤ç‰Œç®¡ç†"å¤„ç‚¹å‡»"æ·»åŠ ä»¤ç‰Œ"è·å– API Keyï¼Œå¹¶è®¾ç½® `VIP åˆ†ç»„`
2. åœ¨ç¨‹åºä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
   ```bash
   GEMINI_BASE_URL=http://162.105.151.181
   GEMINI_API_KEY=sk-{YOUR_API_KEY}
   ```
3. ä½¿ç”¨ Python çš„ google-generativeai åº“è°ƒç”¨å¤§æ¨¡å‹ï¼š
   ```python
   import google.generativeai as genai

   genai.configure(
       api_key="sk-{YOUR_API_KEY}",
       transport="rest",
       client_options={"api_endpoint": "http://162.105.151.181"}
   )

   model = genai.GenerativeModel("gemini-2.5-flash")
   response = model.generate_content("Who are you?")
   print(response.text)
   ```
4. æˆ–è€…ç”¨ curl å‘èµ·è¯·æ±‚ï¼ˆ`:streamGenerateContent` è¡¨ç¤ºæµå¼è¾“å‡ºï¼‰ï¼š
   ```bash
   curl -N "http://162.105.151.181/v1beta/models/gemini-2.5-pro:streamGenerateContent" \
   -H "Content-Type: application/json" \
   -H "Authorization: Bearer sk-{YOUR_API_KEY}" \
   -d '{
      "contents": [{"parts":[{"text": "Who are you?"}]}]
   }'
   ```


## å†…æµ‹ç¾¤ä¸ Bug åé¦ˆ

<img src="./llm-gateway/3.jpg" alt="å†…æµ‹ç¾¤äºŒç»´ç " width="300" />

æ„Ÿè°¢å‡ ä½å‚ä¸å†…æµ‹çš„å¿—æ„¿è€…åŒå­¦ï¼è¿™é‡Œè®°å½•ä¸€ä¸‹å¤§å®¶å‘ç°çš„ New API å¹³å°çš„ bugã€‚

### 1. æ¨¡å‹æ“ç»ƒåœºä»£ç å—å¤åˆ¶æ²¡æ¢è¡Œ

å·²æ issueï¼šhttps://github.com/QuantumNous/new-api/issues/1828 ã€‚
bug å·²ä¿®å¤ã€‚

### 2. è°ƒç”¨æŸäº›æ¨¡å‹ä¼šå‡ºç° access denied æŠ¥é”™

è¯·è”ç³»ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ä¼šåˆ é™¤å“ªäº›è¯¯æ·»åŠ çš„æ¨¡å‹ï¼›æš‚æ—¶åœ¨å¿—æ„¿è€…åŒå­¦çš„å¸®åŠ©ä¸‹ï¼Œå·²ç»ç§»é™¤äº†æ‰€æœ‰ä¸èƒ½è®¿é—®çš„æ¨¡å‹ã€‚

### 3. æŸäº›æ¨¡å‹ä¸æ”¯æŒ top_p = 1.0ï¼Œä½†æ˜¯æ¨¡å‹æ“ç»ƒåœºé»˜è®¤çš„ top_p = 1.0

æŸäº›æ¨¡å‹ top_p è¦æ±‚å°äº 1ã€‚è¯·æ‰‹åŠ¨ä¿®æ”¹ top_p å‚æ•°ã€‚
